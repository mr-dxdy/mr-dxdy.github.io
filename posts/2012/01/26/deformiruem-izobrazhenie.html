<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Личный блог Анциферова Германа</title>

    <link href="/stylesheets/application.css" rel="stylesheet" type="text/css" media="all" />
    <link href="/stylesheets/highlighting.css" rel="stylesheet" type="text/css" />

    <script src="/javascripts/application.js" type="text/javascript"></script>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/posts/feed.xml" />
  </head>
  <body>

    <div class="wrapper">
      <header class="header">
  <div class="container header__content">
    <div class="user-photo header__user-photo">
<a class="user-photo__link" href="/">        <img class="user-photo__image" src="/images/avatar.png" />
</a>    </div>
    <div class="user-vcard header__user-vcard">
      <div class="user-vcard__name">Анциферов Герман</div>
      <div class="user-vcard__short-bio">
        Привет, мир! Пишу о себе, программировании и о чем-то еще ...
      </div>
    </div>
  </div>
</header>


      <section class="blog container">
        <div class="blog__aside">
          <nav class="menu">
<a class="menu-item selected" href="/posts/categories/Новости.html">      Новости
      <span class="counter">15</span>
</a><a class="menu-item " href="/posts/categories/linux.html">      Linux
      <span class="counter">2</span>
</a><a class="menu-item " href="/posts/categories/ruby.html">      Ruby
      <span class="counter">1</span>
</a><a class="menu-item " href="/posts/categories/Алгоритмы.html">      Алгоритмы
      <span class="counter">5</span>
</a><a class="menu-item " href="/posts/categories/cuda.html">      Cuda
      <span class="counter">1</span>
</a><a class="menu-item " href="/posts/categories/monit.html">      Monit
      <span class="counter">1</span>
</a></nav>

        </div>
        <div class="blog__content">
            <article class="article">
      <h2 class="title article__title">
    <a href="/"><span class="octicon octicon-home title__home"></span></a>
    <span>&raquo;</span>
    <span class="title__article">Деформируем изображение</span>
  </h2>


  <ul class="meta">
  <li class="meta__item">
    <span class="octicon octicon-calendar"></span>
    January 26, 2012
  </li>
    <li class="meta__item">
      <span class="octicon octicon-file-directory"></span>
        <span class="comma"><a class="meta__link" href="/posts/categories/Новости.html">Новости</a></span>
        <span class="comma"><a class="meta__link" href="/posts/categories/Алгоритмы.html">Алгоритмы</a></span>
    </li>
</ul>


  <div class="article__body markdown-body">
    <p>Заканчивает серию программ по предмету &ldquo;Обработка изображений&rdquo; алгоритм &ldquo;Деформация изображения&rdquo;. Не охота лить воду, ведь тема и так серьезная, поэтому с вашего позволения процитирую небольшой текст из лекции:</p>

<blockquote>
<p>Рассмотрим еще одно преобразование изображений, которое можно отнести к классу геометрических процессов. Суть его заключается в том, что на изображение с мелким шагом наносится регулярная триангуляционная сетка. Затем построенная сетка треугольников деформируется неким образом так, что связи между узлами сохраняются.</p>
</blockquote>

<p><img alt="Сетка треугольников" src="/posts/2012/01/26/deformiruem-izobrazhenie/grid_warping.jpeg" />
</p>

<blockquote>
<p>Задача сводится к тому, чтобы на модифицированной сетке воссоздать исходное изображение со всеми деформациями, растяжениями и другими искажениями. Описанная идея называется ворпинг (от анг. warping &ndash; коробить, искривлять) &ndash; преобразование изображения, при котором оно в отдельных областях сжимается и растягивается &ndash; как будто изображение нанесено на резину. Во время ворпирования элементы преобразуемого изображения пытаются принять положение и форму элементов исходного.</p>
</blockquote>

<p>Более подробно с лекциями по предмету Семенова А.Б. &ldquo;Обработка изображений&rdquo; можно познакомиться на сайте <a href="http://developers.sun.ru/content/view/232/121/">developers.sun.ru</a>.</p>

<p><strong>Добавлю свои пять копеек:</strong> Идея такая же как и в масштабировании. У нас есть исходный треугольник и трансформированный. Да-да, нам нужно найти прообраз из результирующего треугольника в исходный. В нашем случаи рассмотрим все на примере</p>
<pre class="highlight text">V1(x1,y1), V2(x2,y2), V3(x3,y3) - вершины треугольника.
V0(x0,y0) - точка в треугольнике.
T1(u1,v1), T2(u2,v2), T3(u3,v3) - текстурные координаты вершин треугольника.
Нужно найти T0(u0,v0).
Найдем барицентрические координаты (U,V - числа) точки V0.
V1 + U(V2 - V1) + V(V3 - V1) = V0
x1 + Ux2 - Ux1 + Vx3 - Vx1 = x0
y1 + Uy2 - Uy1 + Vy3 - Vy1 = y0
Решая эту систему уравнений находим U,V.
Теперь  T0 = T1 + U(T2 - T1) + V(T3 - T1).
Вот и все. Осталось теперь только закрасить точку V0(x0,y0) цветом T0
</pre>
<p>В задаче для сканирования треугольника, нам потребуется функция для проверки принадлежности точки треугольнику:</p>
<pre class="highlight cpp"><span class="cm">/*
  если одинакового знака то внутри,
  если хоть одно число равно 0 то точка лежит на грани,
  в остальных случаях лежит вне треугольника.
*/</span>

<span class="kt">bool</span> <span class="n">Triangle</span><span class="o">::</span><span class="n">isInputPoint</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">point</span><span class="p">){</span>
    <span class="n">Point</span> <span class="o">*</span><span class="n">A</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">m_arrayPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="o">*</span><span class="n">B</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">m_arrayPoints</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="o">*</span><span class="n">C</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">m_arrayPoints</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
   <span class="kt">int</span> <span class="n">N1</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">()</span><span class="o">-</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">())</span><span class="o">*</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">()</span><span class="o">-</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">())</span> <span class="o">-</span> <span class="p">(</span><span class="n">B</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">()</span><span class="o">-</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">())</span><span class="o">*</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">()</span><span class="o">-</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">()),</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">()</span><span class="o">-</span><span class="n">B</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">())</span><span class="o">*</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">()</span><span class="o">-</span><span class="n">B</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">())</span> <span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">()</span><span class="o">-</span><span class="n">B</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">())</span><span class="o">*</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">()</span><span class="o">-</span><span class="n">B</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">()),</span>
            <span class="n">N3</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">()</span><span class="o">-</span><span class="n">C</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">())</span><span class="o">*</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">()</span><span class="o">-</span><span class="n">C</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">())</span> <span class="o">-</span> <span class="p">(</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">()</span><span class="o">-</span><span class="n">C</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">())</span><span class="o">*</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">()</span><span class="o">-</span><span class="n">C</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">());</span>
   <span class="k">return</span> <span class="p">((</span><span class="n">N1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">N2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">N3</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">N1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">N2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">N3</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
            <span class="o">||</span> <span class="n">N1</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">N2</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">N3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p>Для полной картины не хватает примера:</p>

<p><img alt="Ворпинг картинки" src="/posts/2012/01/26/deformiruem-izobrazhenie/girl_warping.jpeg" /></p>

  </div>

  

</article>

<div class="comments article__comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES * * */
      var disqus_shortname = 'german-antsiferov';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>


        </div>
      </section>
    </div>

    <footer class="footer">
  <p>
    <span class="copyright footer__copyright">
      Copyright &copy; 2018 Анциферов Герман
    </span>
  </p>
</footer>

    <!-- Yandex.Metrika counter --><script type="text/javascript"> (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter32769165 = new Ya.Metrika({ id:32769165, clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true }); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="https://mc.yandex.ru/watch/32769165" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter -->

  </body>
</html>
