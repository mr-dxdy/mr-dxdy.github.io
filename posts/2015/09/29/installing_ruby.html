<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Личный блог Анциферова Германа</title>

    <link href="/stylesheets/application.css" rel="stylesheet" type="text/css" media="all" />
    <link href="/stylesheets/highlighting.css" rel="stylesheet" type="text/css" />

    <script src="/javascripts/application.js" type="text/javascript"></script>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/posts/feed.xml" />
  </head>
  <body>

    <div class="wrapper">
      <header class="header">
  <div class="container header__content">
    <div class="user-photo header__user-photo">
<a class="user-photo__link" href="/">        <img class="user-photo__image" src="/images/avatar.png" />
</a>    </div>
    <div class="user-vcard header__user-vcard">
      <div class="user-vcard__name">Анциферов Герман</div>
      <div class="user-vcard__short-bio">
        Привет, мир! Пишу о себе, программировании и о чем-то еще ...
      </div>
    </div>
  </div>
</header>


      <section class="blog container">
        <div class="blog__aside">
          <nav class="menu">
<a class="menu-item selected" href="/posts/categories/Новости.html">      Новости
      <span class="counter">15</span>
</a><a class="menu-item " href="/posts/categories/linux.html">      Linux
      <span class="counter">2</span>
</a><a class="menu-item " href="/posts/categories/ruby.html">      Ruby
      <span class="counter">1</span>
</a><a class="menu-item " href="/posts/categories/Алгоритмы.html">      Алгоритмы
      <span class="counter">5</span>
</a><a class="menu-item " href="/posts/categories/cuda.html">      Cuda
      <span class="counter">1</span>
</a><a class="menu-item " href="/posts/categories/monit.html">      Monit
      <span class="counter">1</span>
</a></nav>

        </div>
        <div class="blog__content">
            <article class="article">
      <h2 class="title article__title">
    <a href="/"><span class="octicon octicon-home title__home"></span></a>
    <span>&raquo;</span>
    <span class="title__article">Installing Ruby</span>
  </h2>


  <ul class="meta">
  <li class="meta__item">
    <span class="octicon octicon-calendar"></span>
    September 29, 2015
  </li>
    <li class="meta__item">
      <span class="octicon octicon-file-directory"></span>
        <span class="comma"><a class="meta__link" href="/posts/categories/Новости.html">Новости</a></span>
        <span class="comma"><a class="meta__link" href="/posts/categories/ruby.html">Ruby</a></span>
    </li>
</ul>


  <div class="article__body markdown-body">
    <h2>Patch 41808</h2>

<p>При установке ruby-1.9.3 возникает ошибка:</p>
<pre class="highlight text">ec_group_new_curve_gf2m&#39; undeclared (first use in this function)
</pre>
<p>Проблема решается с помощью установки патча:</p>
<pre class="highlight text">curl -fsSL https://gist.githubusercontent.com/petems/8420477/raw/4b23330b5c3cb5616eb90908c98421e4873e6ca6/41808.diff | rbenv install --patch 1.9.3-p194
</pre>
<p>
Source code of patch #41808:</p>
<pre class="highlight cpp"><span class="nl">Index:</span> <span class="n">ext</span><span class="o">/</span><span class="n">openssl</span><span class="o">/</span><span class="n">ossl_pkey_ec</span><span class="p">.</span><span class="n">c</span>
<span class="o">===================================================================</span>
<span class="o">---</span> <span class="n">ext</span><span class="o">/</span><span class="n">openssl</span><span class="o">/</span><span class="n">ossl_pkey_ec</span><span class="p">.</span><span class="n">c</span>  <span class="p">(</span><span class="n">revision</span> <span class="mi">41807</span><span class="p">)</span>
<span class="o">+++</span> <span class="n">ext</span><span class="o">/</span><span class="n">openssl</span><span class="o">/</span><span class="n">ossl_pkey_ec</span><span class="p">.</span><span class="n">c</span>  <span class="p">(</span><span class="n">revision</span> <span class="mi">41808</span><span class="p">)</span>
<span class="err">@@</span> <span class="o">-</span><span class="mi">757</span><span class="p">,</span><span class="mi">8</span> <span class="o">+</span><span class="mi">757</span><span class="p">,</span><span class="mi">10</span> <span class="err">@@</span>
                 <span class="n">method</span> <span class="o">=</span> <span class="n">EC_GFp_mont_method</span><span class="p">();</span>
             <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">s_GFp_nist</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">method</span> <span class="o">=</span> <span class="n">EC_GFp_nist_method</span><span class="p">();</span>
<span class="o">+</span><span class="err">#</span><span class="k">if</span> <span class="o">!</span><span class="n">defined</span><span class="p">(</span><span class="n">OPENSSL_NO_EC2M</span><span class="p">)</span>
             <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">s_GF2m_simple</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">method</span> <span class="o">=</span> <span class="n">EC_GF2m_simple_method</span><span class="p">();</span>
<span class="o">+</span><span class="err">#</span><span class="n">endif</span>
             <span class="p">}</span>

             <span class="k">if</span> <span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="p">{</span>
<span class="err">@@</span> <span class="o">-</span><span class="mi">811</span><span class="p">,</span><span class="mi">8</span> <span class="o">+</span><span class="mi">811</span><span class="p">,</span><span class="mi">10</span> <span class="err">@@</span>

             <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">s_GFp</span><span class="p">)</span> <span class="p">{</span>
                 <span class="k">new</span><span class="n">_curve</span> <span class="o">=</span> <span class="n">EC_GROUP_new_curve_GFp</span><span class="p">;</span>
<span class="o">+</span><span class="err">#</span><span class="k">if</span> <span class="o">!</span><span class="n">defined</span><span class="p">(</span><span class="n">OPENSSL_NO_EC2M</span><span class="p">)</span>
             <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">s_GF2m</span><span class="p">)</span> <span class="p">{</span>
                 <span class="k">new</span><span class="n">_curve</span> <span class="o">=</span> <span class="n">EC_GROUP_new_curve_GF2m</span><span class="p">;</span>
<span class="o">+</span><span class="err">#</span><span class="n">endif</span>
             <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                 <span class="n">rb_raise</span><span class="p">(</span><span class="n">rb_eArgError</span><span class="p">,</span> <span class="s">&quot;unknown symbol, must be :GFp or :GF2m&quot;</span><span class="p">);</span>
             <span class="p">}</span>
</pre>
<p>Аналогичная ситуация возникает при установке ruby-1.8.7-p375:</p>
<pre class="highlight shell">curl -fsSL https://gist.github.com/thescouser89/8102408/raw/417cba9fee6ba1945b967b5ef236f676bd5005e0/1.8.7-rbenv.patch | rbenv install --patch 1.8.7-p375

</pre><pre class="highlight cpp"><span class="o">---</span> <span class="n">ext</span><span class="o">/</span><span class="n">openssl</span><span class="o">/</span><span class="n">ossl_pkey_ec</span><span class="p">.</span><span class="n">c</span>
<span class="o">+++</span> <span class="n">ext</span><span class="o">/</span><span class="n">openssl</span><span class="o">/</span><span class="n">ossl_pkey_ec</span><span class="p">.</span><span class="n">c</span>
<span class="err">@@</span> <span class="o">-</span><span class="mi">757</span><span class="p">,</span><span class="mi">8</span> <span class="o">+</span><span class="mi">757</span><span class="p">,</span><span class="mi">10</span> <span class="err">@@</span> <span class="k">static</span> <span class="n">VALUE</span> <span class="n">ossl_ec_group_initialize</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">VALUE</span> <span class="o">*</span><span class="n">argv</span><span class="p">,</span> <span class="n">VALUE</span> <span class="n">self</span><span class="p">)</span>
                 <span class="n">method</span> <span class="o">=</span> <span class="n">EC_GFp_mont_method</span><span class="p">();</span>
             <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">s_GFp_nist</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">method</span> <span class="o">=</span> <span class="n">EC_GFp_nist_method</span><span class="p">();</span>
<span class="o">+</span><span class="err">#</span><span class="k">if</span> <span class="o">!</span><span class="n">defined</span><span class="p">(</span><span class="n">OPENSSl_NO_EC2M</span><span class="p">)</span>
             <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">s_GF2m_simple</span><span class="p">)</span> <span class="p">{</span>
                 <span class="n">method</span> <span class="o">=</span> <span class="n">EC_GF2m_simple_method</span><span class="p">();</span>
<span class="o">+</span><span class="err">#</span><span class="n">endif</span>
             <span class="p">}</span>

             <span class="k">if</span> <span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="p">{</span>
<span class="err">@@</span> <span class="o">-</span><span class="mi">811</span><span class="p">,</span><span class="mi">8</span> <span class="o">+</span><span class="mi">813</span><span class="p">,</span><span class="mi">10</span> <span class="err">@@</span> <span class="k">static</span> <span class="n">VALUE</span> <span class="n">ossl_ec_group_initialize</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">VALUE</span> <span class="o">*</span><span class="n">argv</span><span class="p">,</span> <span class="n">VALUE</span> <span class="n">self</span><span class="p">)</span>

             <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">s_GFp</span><span class="p">)</span> <span class="p">{</span>
                 <span class="k">new</span><span class="n">_curve</span> <span class="o">=</span> <span class="n">EC_GROUP_new_curve_GFp</span><span class="p">;</span>
<span class="o">+</span><span class="err">#</span><span class="k">if</span> <span class="o">!</span><span class="n">defined</span><span class="p">(</span><span class="n">OPENSSL_NO_EC2M</span><span class="p">)</span>
             <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">s_GF2m</span><span class="p">)</span> <span class="p">{</span>
                 <span class="k">new</span><span class="n">_curve</span> <span class="o">=</span> <span class="n">EC_GROUP_new_curve_GF2m</span><span class="p">;</span>
<span class="o">+</span><span class="err">#</span><span class="n">endif</span>
             <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                 <span class="n">rb_raise</span><span class="p">(</span><span class="n">rb_eArgError</span><span class="p">,</span> <span class="s">&quot;unknown symbol, must be :GFp or :GF2m&quot;</span><span class="p">);</span>
             <span class="p">}</span>
</pre>
<h3>Источник</h3>

<p><a href="https://github.com/sstephenson/ruby-build/wiki#make-error-for-200-p247-and-lower-on-fedorared-hat">Ruby-build WIKI</a></p>

<h2>Readline (LoadError)</h2>

<p>I was greeted with the following message:</p>
<pre class="highlight shell">require: cannot load such file -- readline <span class="o">(</span>LoadError<span class="o">)</span>
</pre>
<p>The solutions:</p>
<pre class="highlight shell"><span class="c"># zypper install libreadline5</span>
curl -fsSL https://gist.github.com/LeonB/10503374/raw | rbenv install --patch 2.0.0-p451
</pre>
<p>Source code of patch:</p>
<pre class="highlight cpp"><span class="n">diff</span> <span class="o">--</span><span class="n">git</span> <span class="n">ext</span><span class="o">/</span><span class="n">readline</span><span class="o">/</span><span class="n">extconf</span><span class="p">.</span><span class="n">rb</span> <span class="n">ext</span><span class="o">/</span><span class="n">readline</span><span class="o">/</span><span class="n">extconf</span><span class="p">.</span><span class="n">rb</span>
<span class="n">index</span> <span class="mi">4920137</span><span class="p">.</span><span class="mf">.8e81253</span> <span class="mi">100644</span>
<span class="o">---</span> <span class="n">ext</span><span class="o">/</span><span class="n">readline</span><span class="o">/</span><span class="n">extconf</span><span class="p">.</span><span class="n">rb</span>
<span class="o">+++</span> <span class="n">ext</span><span class="o">/</span><span class="n">readline</span><span class="o">/</span><span class="n">extconf</span><span class="p">.</span><span class="n">rb</span>
<span class="err">@@</span> <span class="o">-</span><span class="mi">19</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">19</span><span class="p">,</span><span class="mi">10</span> <span class="err">@@</span> <span class="n">def</span> <span class="n">readline</span><span class="p">.</span><span class="n">have_func</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">super</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
 <span class="n">end</span>

<span class="o">+</span><span class="n">def</span> <span class="n">readline</span><span class="p">.</span><span class="n">have_type</span><span class="p">(</span><span class="n">type</span><span class="p">)</span>
<span class="o">+</span>  <span class="k">return</span> <span class="n">super</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
<span class="o">+</span><span class="n">end</span>
<span class="o">+</span>
 <span class="n">dir_config</span><span class="p">(</span><span class="err">&#39;</span><span class="n">curses</span><span class="err">&#39;</span><span class="p">)</span>
 <span class="n">dir_config</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ncurses</span><span class="err">&#39;</span><span class="p">)</span>
 <span class="n">dir_config</span><span class="p">(</span><span class="err">&#39;</span><span class="n">termcap</span><span class="err">&#39;</span><span class="p">)</span>
<span class="err">@@</span> <span class="o">-</span><span class="mi">93</span><span class="p">,</span><span class="mi">4</span> <span class="o">+</span><span class="mi">97</span><span class="p">,</span><span class="mi">9</span> <span class="err">@@</span> <span class="n">readline</span><span class="p">.</span><span class="n">have_func</span><span class="p">(</span><span class="s">&quot;remove_history&quot;</span><span class="p">)</span>
 <span class="n">readline</span><span class="p">.</span><span class="n">have_func</span><span class="p">(</span><span class="s">&quot;clear_history&quot;</span><span class="p">)</span>
 <span class="n">readline</span><span class="p">.</span><span class="n">have_func</span><span class="p">(</span><span class="s">&quot;rl_redisplay&quot;</span><span class="p">)</span>
 <span class="n">readline</span><span class="p">.</span><span class="n">have_func</span><span class="p">(</span><span class="s">&quot;rl_insert_text&quot;</span><span class="p">)</span>
<span class="o">+</span>
<span class="o">+</span><span class="n">unless</span> <span class="n">readline</span><span class="p">.</span><span class="n">have_type</span><span class="p">(</span><span class="s">&quot;rl_hook_func_t&quot;</span><span class="p">)</span>
<span class="o">+</span>  <span class="err">$</span><span class="n">defs</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-Drl_hook_func_t=Function&quot;</span>
<span class="o">+</span><span class="n">end</span>
<span class="o">+</span>
 <span class="n">create_makefile</span><span class="p">(</span><span class="s">&quot;readline&quot;</span><span class="p">)</span>
<span class="n">diff</span> <span class="o">--</span><span class="n">git</span> <span class="n">ext</span><span class="o">/</span><span class="n">readline</span><span class="o">/</span><span class="n">readline</span><span class="p">.</span><span class="n">c</span> <span class="n">ext</span><span class="o">/</span><span class="n">readline</span><span class="o">/</span><span class="n">readline</span><span class="p">.</span><span class="n">c</span>
<span class="n">index</span> <span class="mf">3e7</span><span class="n">feea</span><span class="p">..</span><span class="mi">482</span><span class="n">bf80</span> <span class="mi">100644</span>
<span class="o">---</span> <span class="n">ext</span><span class="o">/</span><span class="n">readline</span><span class="o">/</span><span class="n">readline</span><span class="p">.</span><span class="n">c</span>
<span class="o">+++</span> <span class="n">ext</span><span class="o">/</span><span class="n">readline</span><span class="o">/</span><span class="n">readline</span><span class="p">.</span><span class="n">c</span>
<span class="err">@@</span> <span class="o">-</span><span class="mi">1883</span><span class="p">,</span><span class="mi">7</span> <span class="o">+</span><span class="mi">1883</span><span class="p">,</span><span class="mi">7</span> <span class="err">@@</span> <span class="n">Init_readline</span><span class="p">()</span>

     <span class="n">rl_attempted_completion_function</span> <span class="o">=</span> <span class="n">readline_attempted_completion_function</span><span class="p">;</span>
 <span class="cp">#if defined(HAVE_RL_PRE_INPUT_HOOK)
</span><span class="o">-</span>    <span class="n">rl_pre_input_hook</span> <span class="o">=</span> <span class="p">(</span><span class="n">Function</span> <span class="o">*</span><span class="p">)</span><span class="n">readline_pre_input_hook</span><span class="p">;</span>
<span class="o">+</span>    <span class="n">rl_pre_input_hook</span> <span class="o">=</span> <span class="p">(</span><span class="n">rl_hook_func_t</span> <span class="o">*</span><span class="p">)</span><span class="n">readline_pre_input_hook</span><span class="p">;</span>
 <span class="cp">#endif
</span> <span class="cp">#ifdef HAVE_RL_CATCH_SIGNALS
</span>     <span class="n">rl_catch_signals</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre>
<p>Source:</p>

<p><a href="http://www.markholmberg.com/articles/readline-error-when-building-ruby">Readline error when building ruby</a></p>

<h2>Compiling readline.c</h2>

<p>Ошибка при установке ruby 2.0.0:</p>
<pre class="highlight cpp"><span class="n">compiling</span> <span class="n">readline</span><span class="p">.</span><span class="n">c</span>
<span class="n">readline</span><span class="p">.</span><span class="nl">c:</span> <span class="n">In</span> <span class="n">function</span> <span class="err">‘</span><span class="n">Init_readline</span><span class="err">’</span><span class="o">:</span>
<span class="n">readline</span><span class="p">.</span><span class="nl">c:</span><span class="mi">1886</span><span class="o">:</span><span class="mi">26</span><span class="o">:</span> <span class="nl">error:</span> <span class="err">‘</span><span class="n">Function</span><span class="err">’</span> <span class="n">undeclared</span> <span class="p">(</span><span class="n">first</span> <span class="n">use</span> <span class="n">in</span> <span class="k">this</span> <span class="n">function</span><span class="p">)</span>
<span class="n">rl_pre_input_hook</span> <span class="o">=</span> <span class="p">(</span><span class="n">Function</span> <span class="o">*</span><span class="p">)</span><span class="n">readline_pre_input_hook</span><span class="p">;</span>
<span class="o">^</span>
<span class="n">readline</span><span class="p">.</span><span class="nl">c:</span><span class="mi">1886</span><span class="o">:</span><span class="mi">26</span><span class="o">:</span> <span class="nl">note:</span> <span class="n">each</span> <span class="n">undeclared</span> <span class="n">identifier</span> <span class="n">is</span> <span class="n">reported</span> <span class="n">only</span> <span class="n">once</span> <span class="k">for</span> <span class="n">each</span> <span class="n">function</span> <span class="n">it</span> <span class="n">appears</span> <span class="n">in</span>
<span class="n">readline</span><span class="p">.</span><span class="nl">c:</span><span class="mi">1886</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span> <span class="nl">error:</span> <span class="n">expected</span> <span class="n">expression</span> <span class="n">before</span> <span class="err">‘</span><span class="p">)</span><span class="err">’</span> <span class="n">token</span>
<span class="n">rl_pre_input_hook</span> <span class="o">=</span> <span class="p">(</span><span class="n">Function</span> <span class="o">*</span><span class="p">)</span><span class="n">readline_pre_input_hook</span><span class="p">;</span>
<span class="o">^</span>
<span class="n">readline</span><span class="p">.</span><span class="nl">c:</span> <span class="n">At</span> <span class="n">top</span> <span class="nl">level:</span>
<span class="n">readline</span><span class="p">.</span><span class="nl">c:</span><span class="mi">530</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span> <span class="nl">warning:</span> <span class="err">‘</span><span class="n">readline_pre_input_hook</span><span class="err">’</span> <span class="n">defined</span> <span class="n">but</span> <span class="n">not</span> <span class="n">used</span> <span class="p">[</span><span class="o">-</span><span class="n">Wunused</span><span class="o">-</span><span class="n">function</span><span class="p">]</span>
<span class="n">readline_pre_input_hook</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="o">^</span>
<span class="n">make</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">:</span> <span class="o">***</span> <span class="p">[</span><span class="n">readline</span><span class="p">.</span><span class="n">o</span><span class="p">]</span> <span class="err">Ошибка</span> <span class="mi">1</span>
</pre>
<h2>Решение</h2>
<pre class="highlight shell">curl -fsSL https://gist.github.com/LeonB/10503374/raw | rbenv install --patch 2.0.0-p451
</pre>
  </div>

  

</article>

<div class="comments article__comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES * * */
      var disqus_shortname = 'german-antsiferov';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>


        </div>
      </section>
    </div>

    <footer class="footer">
  <p>
    <span class="copyright footer__copyright">
      Copyright &copy; 2018 Анциферов Герман
    </span>
  </p>
</footer>

    <!-- Yandex.Metrika counter --><script type="text/javascript"> (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter32769165 = new Ya.Metrika({ id:32769165, clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true }); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="https://mc.yandex.ru/watch/32769165" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter -->

  </body>
</html>
